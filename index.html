<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KontrolGas - Dashboard Profesional</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .logo {
            font-size: 3.5rem;
            margin-bottom: 10px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
        .title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .gauge-card {
            text-align: center;
        }
        
        .gauge-container {
            position: relative;
            margin: 30px 0;
            padding: 20px 0;
        }
        
        .gauge-svg {
            width: 280px;
            height: 180px; /* AUMENTADO para evitar corte */
            margin: 0 auto;
            display: block;
        }
        
        .gauge-bg {
            stroke: #ecf0f1;
            stroke-width: 14;
            fill: none;
        }
        
        .gauge-fill {
            stroke: #27ae60;
            stroke-width: 14;
            fill: none;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease-in-out, stroke 0.5s ease;
        }
        
        .gauge-percentage {
            font-size: 3.2rem;
            font-weight: 700;
            color: #27ae60;
            margin-top: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: color 0.5s ease;
        }
        
        .gauge-label {
            font-size: 1.1rem;
            color: #7f8c8d;
            margin-top: 8px;
            font-weight: 500;
        }
        
        .digital-display {
            text-align: center;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border-radius: 15px;
            padding: 40px 20px;
            margin: 20px 0;
        }
        
        .digital-value {
            font-size: 4.5rem;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            margin-bottom: 10px;
            letter-spacing: -2px;
        }
        
        .digital-unit {
            font-size: 1.8rem;
            font-weight: 300;
            opacity: 0.9;
        }
        
        .chart-card {
            grid-column: 1 / -1;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
        
        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-connected {
            background: #27ae60;
        }
        
        .status-disconnected {
            background: #e74c3c;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .config-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .config-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .config-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .input-field {
            padding: 12px 16px;
            border: 2px solid #bdc3c7;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .mqtt-info {
            background: rgba(52, 152, 219, 0.1);
            border: 1px solid rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #2980b9;
        }
        
        /* Esquema de colores alternativo */
        .color-scheme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .color-scheme-toggle:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }
        
        /* Esquema de colores suaves */
        .soft-colors {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .soft-colors .gauge-fill {
            stroke: #6c757d;
        }
        
        .soft-colors .gauge-percentage {
            color: #6c757d;
        }
        
        .soft-colors .digital-display {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .soft-colors .btn-primary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
        }
        
        .soft-colors .input-field:focus {
            border-color: #6c757d;
            box-shadow: 0 0 0 3px rgba(108, 117, 125, 0.1);
        }
        
        .soft-colors .status-connected {
            background: #6c757d;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .config-inputs {
                grid-template-columns: 1fr;
            }
            
            .status-bar {
                flex-direction: column;
                text-align: center;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .digital-value {
                font-size: 3.5rem;
            }
            
            .gauge-percentage {
                font-size: 2.5rem;
            }
            
            .gauge-svg {
                width: 240px;
                height: 150px;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <button class="color-scheme-toggle" onclick="toggleColorScheme()">üé® Cambiar Colores</button>
    
    <div class="container">
        <div class="header">
            <div class="logo">‚öñÔ∏è</div>
            <h1 class="title">KontrolGas</h1>
            <div class="subtitle">Dashboard Profesional - Monitoreo en Tiempo Real</div>
        </div>
        
        <div class="mqtt-info">
            <strong>üì° Broker MQTT:</strong> test.mosquitto.org:1883 | 
            <strong>üì§ Topic:</strong> kontrol-gas/esp32/weight | 
            <strong>üîÑ Actualizaci√≥n:</strong> Tiempo real
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <div class="status-indicator status-disconnected" id="connectionIndicator"></div>
                <span id="connectionStatus">Conectando...</span>
            </div>
            <div class="status-item">
                <strong>Cliente ESP32:</strong> <span id="clientId">-</span>
            </div>
            <div class="status-item">
                <strong>√öltima Actualizaci√≥n:</strong> <span id="lastUpdate">-</span>
            </div>
            <div class="status-item">
                <strong>RSSI WiFi:</strong> <span id="rssi">- dBm</span>
            </div>
        </div>
        
        <div class="dashboard-grid">
            <!-- Gr√°fico Semicircular CORREGIDO -->
            <div class="card gauge-card">
                <h3 class="card-title">üìä Nivel de L√≠quido</h3>
                <div class="gauge-container">
                    <svg class="gauge-svg" viewBox="0 0 200 120">
                        <path class="gauge-bg" d="M 20 90 A 80 80 0 0 1 180 90"></path>
                        <path class="gauge-fill" id="gaugeFill" d="M 20 90 A 80 80 0 0 1 20 90"></path>
                        <!-- Marcadores de porcentaje -->
                        <text x="20" y="105" font-size="10" fill="#7f8c8d" text-anchor="middle">0%</text>
                        <text x="100" y="25" font-size="10" fill="#7f8c8d" text-anchor="middle">50%</text>
                        <text x="180" y="105" font-size="10" fill="#7f8c8d" text-anchor="middle">100%</text>
                    </svg>
                    <div class="gauge-percentage" id="percentage">0.0%</div>
                    <div class="gauge-label">Disponible</div>
                </div>
            </div>
            
            <!-- Visor Digital -->
            <div class="card">
                <h3 class="card-title">üî¢ Peso Digital</h3>
                <div class="digital-display">
                    <div class="digital-value" id="digitalWeight">0.00</div>
                    <div class="digital-unit">kg</div>
                </div>
            </div>
            
            <!-- Gr√°fico de Consumo -->
            <div class="card chart-card">
                <h3 class="card-title">üìà Consumo √öltimas 24 Horas</h3>
                <div class="chart-container">
                    <canvas class="chart-canvas" id="consumptionChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="config-panel">
            <h3 class="config-title">‚öôÔ∏è Configuraci√≥n de Pesos</h3>
            <div class="config-inputs">
                <div class="input-group">
                    <label class="input-label" for="emptyWeight">Peso Vac√≠o (kg)</label>
                    <input type="number" class="input-field" id="emptyWeight" value="5.0" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label class="input-label" for="fullWeight">Peso Lleno (kg)</label>
                    <input type="number" class="input-field" id="fullWeight" value="15.0" step="0.1" min="0">
                </div>
            </div>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveConfiguration()">
                    üíæ Guardar Configuraci√≥n
                </button>
                <button class="btn btn-secondary" onclick="resetConfiguration()">
                    üîÑ Restablecer
                </button>
            </div>
        </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- MQTT.js Library -->
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    
    <script>
        // Variables globales
        let mqttClient = null;
        let emptyWeight = 5.0;
        let fullWeight = 15.0;
        let lastWeightData = null;
        let connectionAttempts = 0;
        const maxConnectionAttempts = 5;
        let consumptionChart = null;
        let weightHistory = [];
        const maxHistoryPoints = 24;
        let currentColorScheme = 'default';
        
        // Configuraci√≥n MQTT
        const brokerUrl = 'wss://test.mosquitto.org:8081';
        const topic = 'kontrol-gas/esp32/weight';
        
        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando Dashboard Profesional KontrolGas');
            loadConfiguration();
            loadColorScheme();
            initializeChart();
            connectMQTT();
            
            // Actualizar cada 3 segundos
            setInterval(updateDisplay, 3000);
            
            // Guardar datos hist√≥ricos cada hora
            setInterval(saveHistoricalData, 3600000);
        });
        
        function toggleColorScheme() {
            if (currentColorScheme === 'default') {
                document.body.classList.add('soft-colors');
                currentColorScheme = 'soft';
                localStorage.setItem('colorScheme', 'soft');
            } else {
                document.body.classList.remove('soft-colors');
                currentColorScheme = 'default';
                localStorage.setItem('colorScheme', 'default');
            }
            
            // Actualizar colores del gr√°fico
            if (consumptionChart) {
                const newColor = currentColorScheme === 'soft' ? '#6c757d' : '#27ae60';
                consumptionChart.data.datasets[0].borderColor = newColor;
                consumptionChart.data.datasets[0].backgroundColor = newColor + '20';
                consumptionChart.data.datasets[0].pointBackgroundColor = newColor;
                consumptionChart.update();
            }
        }
        
        function loadColorScheme() {
            const savedScheme = localStorage.getItem('colorScheme');
            if (savedScheme === 'soft') {
                document.body.classList.add('soft-colors');
                currentColorScheme = 'soft';
            }
        }
        
        function connectMQTT() {
            connectionAttempts++;
            console.log(`üîÑ Conectando MQTT (intento ${connectionAttempts}/${maxConnectionAttempts})...`);
            
            updateConnectionStatus('Conectando...', false);
            
            try {
                const clientId = 'KontrolGas-Dashboard-' + Math.random().toString(16).substr(2, 8);
                mqttClient = mqtt.connect(brokerUrl, {
                    clientId: clientId,
                    keepalive: 30,
                    reconnectPeriod: 5000,
                    connectTimeout: 10000
                });
                
                mqttClient.on('connect', function() {
                    console.log('‚úÖ MQTT conectado exitosamente');
                    updateConnectionStatus('Conectado', true);
                    connectionAttempts = 0;
                    
                    mqttClient.subscribe(topic, function(err) {
                        if (!err) {
                            console.log(`üì• Suscrito al topic: ${topic}`);
                        } else {
                            console.error('‚ùå Error suscribi√©ndose:', err);
                        }
                    });
                });
                
                mqttClient.on('message', function(receivedTopic, message) {
                    if (receivedTopic === topic) {
                        try {
                            const data = JSON.parse(message.toString());
                            console.log('üì® Datos recibidos:', data);
                            lastWeightData = data;
                            updateDisplay();
                        } catch (error) {
                            console.error('‚ùå Error parseando mensaje:', error);
                        }
                    }
                });
                
                mqttClient.on('error', function(error) {
                    console.error('‚ùå Error MQTT:', error);
                    updateConnectionStatus('Error de conexi√≥n', false);
                    
                    if (connectionAttempts < maxConnectionAttempts) {
                        setTimeout(connectMQTT, 5000);
                    } else {
                        updateConnectionStatus('Sin conexi√≥n', false);
                    }
                });
                
                mqttClient.on('close', function() {
                    console.log('üîå Conexi√≥n MQTT cerrada');
                    updateConnectionStatus('Desconectado', false);
                });
                
            } catch (error) {
                console.error('üí• Error creando cliente MQTT:', error);
                updateConnectionStatus('Error cr√≠tico', false);
                
                if (connectionAttempts < maxConnectionAttempts) {
                    setTimeout(connectMQTT, 5000);
                }
            }
        }
        
        function updateDisplay() {
            if (!lastWeightData) {
                return;
            }
            
            const weight = lastWeightData.weight || 0;
            const clientId = lastWeightData.client_id || '-';
            const rssi = lastWeightData.rssi || 0;
            
            // Calcular peso neto del l√≠quido
            const liquidWeight = Math.max(0, weight - emptyWeight);
            
            // Calcular porcentaje
            const totalCapacity = fullWeight - emptyWeight;
            const percentage = Math.max(0, Math.min(100, (liquidWeight / totalCapacity) * 100));
            
            // Actualizar visor digital (peso del l√≠quido disponible)
            document.getElementById('digitalWeight').textContent = liquidWeight.toFixed(2);
            
            // Actualizar porcentaje con 1 decimal
            document.getElementById('percentage').textContent = percentage.toFixed(1) + '%';
            updateGauge(percentage);
            
            // Actualizar informaci√≥n de estado
            document.getElementById('clientId').textContent = clientId;
            document.getElementById('rssi').textContent = rssi + ' dBm';
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            
            // Agregar punto al gr√°fico de consumo
            addDataPoint(weight);
            
            console.log(`üìä Peso total: ${weight.toFixed(2)} kg | L√≠quido: ${liquidWeight.toFixed(2)} kg | Porcentaje: ${percentage.toFixed(1)}%`);
        }
        
        function updateGauge(percentage) {
            const gauge = document.getElementById('gaugeFill');
            const gaugePercentage = document.getElementById('percentage');
            
            // Calcular el arco basado en el porcentaje (semic√≠rculo de 180 grados)
            const angle = (percentage / 100) * 180;
            const radians = (angle * Math.PI) / 180;
            
            // Punto inicial (izquierda del semic√≠rculo)
            const startX = 20;
            const startY = 90;
            
            // Punto final basado en el √°ngulo
            const endX = 100 + 80 * Math.cos(Math.PI - radians);
            const endY = 90 - 80 * Math.sin(Math.PI - radians);
            
            // Determinar si necesitamos el arco largo
            const largeArcFlag = angle > 90 ? 1 : 0;
            
            // Crear el path del arco
            const path = `M ${startX} ${startY} A 80 80 0 ${largeArcFlag} 1 ${endX} ${endY}`;
            gauge.setAttribute('d', path);
            
            // Cambiar colores seg√∫n porcentaje
            let color, textColor;
            if (percentage < 20) {
                color = '#e74c3c'; // Rojo
                textColor = '#e74c3c';
            } else if (percentage < 40) {
                color = '#f39c12'; // Naranja
                textColor = '#f39c12';
            } else if (percentage < 70) {
                color = '#f1c40f'; // Amarillo
                textColor = '#f1c40f';
            } else if (percentage < 90) {
                color = '#27ae60'; // Verde
                textColor = '#27ae60';
            } else {
                color = '#3498db'; // Azul
                textColor = '#3498db';
            }
            
            // Aplicar colores considerando el esquema actual
            if (currentColorScheme === 'soft') {
                color = '#6c757d';
                textColor = '#6c757d';
            }
            
            gauge.setAttribute('stroke', color);
            gaugePercentage.style.color = textColor;
        }
        
        function updateConnectionStatus(message, isConnected) {
            const statusElement = document.getElementById('connectionStatus');
            const indicatorElement = document.getElementById('connectionIndicator');
            
            statusElement.textContent = message;
            
            if (isConnected) {
                indicatorElement.className = 'status-indicator status-connected';
            } else {
                indicatorElement.className = 'status-indicator status-disconnected';
            }
        }
        
        function initializeChart() {
            const ctx = document.getElementById('consumptionChart').getContext('2d');
            
            // Generar etiquetas de las √∫ltimas 24 horas
            const labels = [];
            const now = new Date();
            for (let i = 23; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                labels.push(time.getHours().toString().padStart(2, '0') + ':00');
            }
            
            const chartColor = currentColorScheme === 'soft' ? '#6c757d' : '#27ae60';
            
            consumptionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Peso (kg)',
                        data: new Array(24).fill(null),
                        borderColor: chartColor,
                        backgroundColor: chartColor + '20',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: chartColor,
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Hora',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Peso (kg)',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            beginAtZero: true
                        }
                    },
                    elements: {
                        point: {
                            hoverBackgroundColor: chartColor
                        }
                    }
                }
            });
            
            // Cargar datos hist√≥ricos
            loadHistoricalData();
        }
        
        function addDataPoint(weight) {
            if (!consumptionChart) return;
            
            const now = new Date();
            const currentHour = now.getHours();
            
            // Actualizar el punto correspondiente a la hora actual
            consumptionChart.data.datasets[0].data[currentHour] = weight;
            consumptionChart.update('none');
        }
        
        function saveHistoricalData() {
            if (!lastWeightData) return;
            
            const now = new Date();
            const hourKey = `weight_${now.getFullYear()}_${now.getMonth()}_${now.getDate()}_${now.getHours()}`;
            
            localStorage.setItem(hourKey, JSON.stringify({
                weight: lastWeightData.weight,
                timestamp: now.getTime()
            }));
            
            // Limpiar datos antiguos (m√°s de 24 horas)
            const cutoffTime = now.getTime() - (24 * 60 * 60 * 1000);
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('weight_')) {
                    const data = JSON.parse(localStorage.getItem(key));
                    if (data.timestamp < cutoffTime) {
                        localStorage.removeItem(key);
                    }
                }
            }
        }
        
        function loadHistoricalData() {
            if (!consumptionChart) return;
            
            const now = new Date();
            const data = new Array(24).fill(null);
            
            // Cargar datos de las √∫ltimas 24 horas
            for (let i = 0; i < 24; i++) {
                const time = new Date(now.getTime() - (23 - i) * 60 * 60 * 1000);
                const hourKey = `weight_${time.getFullYear()}_${time.getMonth()}_${time.getDate()}_${time.getHours()}`;
                
                const savedData = localStorage.getItem(hourKey);
                if (savedData) {
                    const weightData = JSON.parse(savedData);
                    data[i] = weightData.weight;
                }
            }
            
            consumptionChart.data.datasets[0].data = data;
            consumptionChart.update();
        }
        
        function loadConfiguration() {
            const savedEmpty = localStorage.getItem('emptyWeight');
            const savedFull = localStorage.getItem('fullWeight');
            
            if (savedEmpty) {
                emptyWeight = parseFloat(savedEmpty);
                document.getElementById('emptyWeight').value = emptyWeight;
            }
            
            if (savedFull) {
                fullWeight = parseFloat(savedFull);
                document.getElementById('fullWeight').value = fullWeight;
            }
            
            console.log(`‚öôÔ∏è Configuraci√≥n cargada: Vac√≠o=${emptyWeight}kg, Lleno=${fullWeight}kg`);
        }
        
        function saveConfiguration() {
            emptyWeight = parseFloat(document.getElementById('emptyWeight').value);
            fullWeight = parseFloat(document.getElementById('fullWeight').value);
            
            if (emptyWeight >= fullWeight) {
                alert('‚ùå Error: El peso vac√≠o debe ser menor que el peso lleno');
                return;
            }
            
            localStorage.setItem('emptyWeight', emptyWeight);
            localStorage.setItem('fullWeight', fullWeight);
            
            console.log(`üíæ Configuraci√≥n guardada: Vac√≠o=${emptyWeight}kg, Lleno=${fullWeight}kg`);
            alert('‚úÖ Configuraci√≥n guardada correctamente');
            
            updateDisplay();
        }
        
        function resetConfiguration() {
            emptyWeight = 5.0;
            fullWeight = 15.0;
            
            document.getElementById('emptyWeight').value = emptyWeight;
            document.getElementById('fullWeight').value = fullWeight;
            
            localStorage.removeItem('emptyWeight');
            localStorage.removeItem('fullWeight');
            
            console.log('üîÑ Configuraci√≥n restablecida');
            alert('üîÑ Configuraci√≥n restablecida a valores por defecto');
            
            updateDisplay();
        }
    </script>
</body>
</html
